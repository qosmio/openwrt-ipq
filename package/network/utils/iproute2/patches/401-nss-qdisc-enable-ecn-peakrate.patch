--- a/tc/q_nss.c
+++ b/tc/q_nss.c
@@ -432,8 +432,8 @@ static struct qdisc_util nssfifo_qdisc_u

 static void nssfq_codel_explain(void)
 {
-	fprintf(stderr, "Usage: ... nssfq_codel target TIME interval TIME [ flows NUMBER ] [ quantum BYTES ]"
-				"[ limit PACKETS ] [ set_default ] [ accel_mode ]\n");
+	fprintf(stderr, "Usage: ... nssfq_codel target TIME interval TIME [ flows NUMBER ] [ quantum BYTES ] "
+				"[ limit PACKETS ] [ ecn | noecn ] [ set_default ] [ accel_mode ]\n");
 }

 static void nssfq_codel_explain_err1(void)
@@ -482,9 +482,9 @@ static int nssfq_codel_parse_opt(const s
 				return -1;
 			}
 		} else if (strcmp(*argv, "ecn") == 0) {
-			fprintf(stderr, "Illegal, ECN not supported\n");
-			nssfq_codel_explain();
-			return -1;
+			opt.ecn = 1;
+		} else if (strcmp(*argv, "noecn") == 0) {
+			opt.ecn = 0;
 		} else if (strcmp(*argv, "set_default") == 0) {
 			opt.set_default = 1;
 		} else if (strcmp(*argv, "accel_mode") == 0) {
@@ -737,7 +737,8 @@ static struct qdisc_util nsscodel_qdisc_

 static void nsstbl_explain(void)
 {
-	fprintf(stderr, "Usage: ... nsstbl burst BYTES rate BPS [ mtu BYTES ] [ accel_mode ]\n");
+	fprintf(stderr, "Usage: ... nsstbl burst BYTES rate BPS [ peakrate BPS ]"
+				" [ mtu BYTES ] [ accel_mode ]\n");
 }

 static int nsstbl_parse_opt(const struct qdisc_util *qu, int argc, char **argv, struct nlmsghdr *n, const char *dev)
@@ -787,7 +788,18 @@ static int nsstbl_parse_opt(const struct
 			}
 			ok++;
-		} else if (strcmp(*argv, "accel_mode") == 0) {
+		} else if (strcmp(*argv, "peakrate") == 0) {
+			NEXT_ARG();
+			if (opt.peakrate) {
+				fprintf(stderr, "Double \"peakrate\" spec\n");
+				return -1;
+			}
+			if (get_rate(&opt.peakrate, *argv)) {
+				fprintf(stderr, "Illegal \"peakrate\"\n");
+				return -1;
+			}
+			ok++;
+		} else if (strcmp(*argv, "accel_mode") == 0) {
 			NEXT_ARG();
 			if (get_u8(&opt.accel_mode, *argv, 0)) {
 				fprintf(stderr, "Illegal accel_mode value\n");
@@ -823,10 +835,6 @@ static int nsstbl_parse_opt(const struct
 		return -1;
 	}

-	/*
-	 * Peakrate is currently not supported, but we keep the infrastructure
-	 * for future use. However, we have disabled taking input for this.
-	 */
 	if (opt.peakrate) {
 		if (!opt.mtu) {
 			fprintf(stderr, "\"mtu\" is required, if \"peakrate\" is requested.\n");
@@ -861,6 +869,8 @@ static int nsstbl_print_opt(const struct
 	fprintf(f, "buffer/maxburst %s ", sprint_size(qopt->burst, b1));
 	tc_print_rate(PRINT_FP, NULL, "rate %s ", qopt->rate);
 	fprintf(f, "mtu %s ", sprint_size(qopt->mtu, b1));
+	if (qopt->peakrate)
+		tc_print_rate(PRINT_FP, NULL, "peakrate %s ", qopt->peakrate);
 	fprintf(f, "accel_mode %d ", qopt->accel_mode);

 	return 0;
